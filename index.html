<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ü–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö –¢—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
        }
        
        #header {
            background: linear-gradient(135deg, #0057b7 0%, #ffd700 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 2em;
        }
        
        #info-panel {
            background: #16213e;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .info-box {
            background: #0f3460;
            padding: 15px 25px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .info-box h3 {
            color: #ffd700;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .info-box p {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        #map {
            height: calc(100vh - 200px);
            width: 100%;
        }
        
        .alert-active {
            background: #e74c3c !important;
            border-left-color: #c0392b !important;
        }
        
        .alert-active p {
            color: #fff;
        }
        
        .legend {
            background: rgba(22, 33, 62, 0.95);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
            color: #eee;
            border: 2px solid #ffd700;
        }
        
        .legend h4 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            margin-right: 10px;
            border-radius: 4px;
            border: 1px solid #fff;
        }
        
        .status-message {
            background: #0f3460;
            padding: 10px;
            text-align: center;
            font-size: 0.9em;
            color: #ffd700;
        }
        
        .popup-content {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .popup-content h3 {
            color: #0057b7;
            margin-bottom: 10px;
        }
        
        .threat-info {
            background: #ffe6e6;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid #e74c3c;
        }
        
        .safe-info {
            background: #e6ffe6;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid #27ae60;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üö® –ö–∞—Ä—Ç–∞ –ü–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö –¢—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏ üá∫üá¶</h1>
    </div>
    
    <div id="info-panel">
        <div class="info-box" id="active-alerts-box">
            <h3>–ê–∫—Ç–∏–≤–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏</h3>
            <p id="active-count">-</p>
        </div>
        <div class="info-box">
            <h3>–†–µ–≥—ñ–æ–Ω—ñ–≤ —É –±–µ–∑–ø–µ—Ü—ñ</h3>
            <p id="safe-count">-</p>
        </div>
        <div class="info-box">
            <h3>–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</h3>
            <p id="last-update" style="font-size: 1em;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
        </div>
    </div>
    
    <div class="status-message" id="status">
        –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö...
    </div>
    
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏
        const map = L.map('map').setView([48.5, 31.5], 6);

        // –ë–∞–∑–æ–≤–∏–π —à–∞—Ä –∫–∞—Ä—Ç–∏
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ä–µ–≥—ñ–æ–Ω—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏
        const regions = {
            "–í—ñ–Ω–Ω–∏—Ü—å–∫–∞": [49.233083, 28.468217],
            "–í–æ–ª–∏–Ω—Å—å–∫–∞": [50.747231, 25.325432],
            "–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞": [48.464717, 35.046183],
            "–î–æ–Ω–µ—Ü—å–∫–∞": [48.015883, 37.80285],
            "–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞": [50.254417, 28.658667],
            "–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞": [48.6208, 22.2879],
            "–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞": [47.838800, 35.139567],
            "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞": [48.922633, 24.711117],
            "–ö–∏—ó–≤—Å—å–∫–∞": [50.4501, 30.5234],
            "–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞": [48.507933, 32.262517],
            "–õ—É–≥–∞–Ω—Å—å–∫–∞": [48.574100, 39.307815],
            "–õ—å–≤—ñ–≤—Å—å–∫–∞": [49.839683, 24.029717],
            "–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞": [46.975033, 32.0],
            "–û–¥–µ—Å—å–∫–∞": [46.482583, 30.7233],
            "–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞": [49.588267, 34.551417],
            "–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞": [50.619900, 26.251617],
            "–°—É–º—Å—å–∫–∞": [50.9077, 34.7981],
            "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞": [49.553517, 25.594767],
            "–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞": [49.993500, 36.230383],
            "–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞": [46.635417, 32.616867],
            "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞": [49.422983, 26.987217],
            "–ß–µ—Ä–∫–∞—Å—å–∫–∞": [49.444433, 32.059767],
            "–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞": [48.291933, 25.935267],
            "–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞": [51.4982, 31.2893],
            "–ö–∏—ó–≤": [50.4501, 30.5234],
            "–ê–† –ö—Ä–∏–º": [45.0, 34.0]
        };

        let markers = {};
        let alertData = {};

        // –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –º–∞—Ä–∫–µ—Ä–∏ –¥–ª—è –†–§ —Ç–∞ –ë—ñ–ª–æ—Ä—É—Å—ñ
        const poopIcon = L.divIcon({
            html: 'üí©',
            className: 'emoji-icon',
            iconSize: [40, 40]
        });

        const potatoIcon = L.divIcon({
            html: 'ü•î',
            className: 'emoji-icon',
            iconSize: [35, 35]
        });

        // –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è –†–§ (–∫–∞–ª)
        L.marker([55.7558, 37.6173], {icon: poopIcon})
            .addTo(map)
            .bindPopup('<b>üö´ –î–∂–µ—Ä–µ–ª–æ –∞–≥—Ä–µ—Å—ñ—ó</b><br>–ù–µ —î —Ç—É—Ä–∏—Å—Ç–∏—á–Ω–æ—é –ª–æ–∫–∞—Ü—ñ—î—é');

        // –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è –ë—ñ–ª–æ—Ä—É—Å—ñ (–∫–∞—Ä—Ç–æ–ø–ª—è)
        L.marker([53.9045, 27.5615], {icon: potatoIcon})
            .addTo(map)
            .bindPopup('<b>ü•î –ö–∞—Ä—Ç–æ–ø–ª—è–Ω–∞ –¥–∏–∫—Ç–∞—Ç—É—Ä–∞</b><br>–°–ø—ñ–≤—É—á–∞—Å–Ω–∏–∫ –∞–≥—Ä–µ—Å—ñ—ó');

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ –¥–ª—è —Ä–µ–≥—ñ–æ–Ω—ñ–≤
        Object.keys(regions).forEach(region => {
            const marker = L.circleMarker(regions[region], {
                radius: 12,
                fillColor: '#27ae60',
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.7
            }).addTo(map);
            
            markers[region] = marker;
            marker.bindPopup(`<div class="popup-content"><h3>${region}</h3><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p></div>`);
        });

        // –õ–µ–≥–µ–Ω–¥–∞
        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <h4>üõ°Ô∏è –õ–µ–≥–µ–Ω–¥–∞</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60;"></div>
                    <span>–ë–µ–∑ —Ç—Ä–∏–≤–æ–≥–∏</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12;"></div>
                    <span>–ó–∞–≥—Ä–æ–∑–∞ –¥—Ä–æ–Ω—ñ–≤</span>
                </div>
                <div class="legend-item">
                    <span style="font-size: 20px; margin-right: 10px;">üí©</span>
                    <span>–ö—Ä–∞—ó–Ω–∞-–∞–≥—Ä–µ—Å–æ—Ä</span>
                </div>
                <div class="legend-item">
                    <span style="font-size: 20px; margin-right: 10px;">ü•î</span>
                    <span>–ö–∞—Ä—Ç–æ–ø–ª—è–Ω–∏–π —Ä–µ–∂–∏–º</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);

        // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function updateAlerts() {
            try {
                // –°–ø—Ä–æ–±–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API alerts.in.ua
                const response = await fetch('https://api.alerts.in.ua/v1/alerts/active.json');
                
                if (response.ok) {
                    const data = await response.json();
                    updateMapWithData(data);
                    document.getElementById('status').innerHTML = '‚úÖ –î–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω—ñ —É—Å–ø—ñ—à–Ω–æ';
                } else {
                    throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π');
                }
            } catch (error) {
                console.log('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API:', error);
                document.getElementById('status').innerHTML = 
                    '‚ö†Ô∏è –î–µ–º–æ-—Ä–µ–∂–∏–º (–¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –¥–æ API alerts.in.ua)';
                useDemoData();
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏ –∑ –æ—Ç—Ä–∏–º–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
        function updateMapWithData(data) {
            let activeCount = 0;
            alertData = data;

            Object.keys(markers).forEach(region => {
                const regionData = data.find(item => item.location_title === region);
                const marker = markers[region];
                
                if (regionData && regionData.active_alerts && regionData.active_alerts.length > 0) {
                    marker.setStyle({
                        fillColor: '#e74c3c',
                        radius: 15
                    });
                    activeCount++;
                    
                    let popupContent = `<div class="popup-content"><h3>${region}</h3>`;
                    popupContent += `<div class="threat-info"><strong>üö® –ü–û–í–Ü–¢–†–Ø–ù–ê –¢–†–ò–í–û–ì–ê!</strong><br>`;
                    
                    regionData.active_alerts.forEach(alert => {
                        popupContent += `–¢–∏–ø: ${alert.type || '–ù–µ–≤—ñ–¥–æ–º–æ'}<br>`;
                    });
                    
                    popupContent += `</div></div>`;
                    marker.bindPopup(popupContent);
                } else {
                    marker.setStyle({
                        fillColor: '#27ae60',
                        radius: 12
                    });
                    marker.bindPopup(`<div class="popup-content"><h3>${region}</h3><div class="safe-info">‚úÖ –¢—Ä–∏–≤–æ–≥–∏ –Ω–µ–º–∞—î</div></div>`);
                }
            });

            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('safe-count').textContent = Object.keys(regions).length - activeCount;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('uk-UA');
            
            const activeBox = document.getElementById('active-alerts-box');
            if (activeCount > 0) {
                activeBox.classList.add('alert-active');
            } else {
                activeBox.classList.remove('alert-active');
            }
        }

        // –î–µ–º–æ-–¥–∞–Ω—ñ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É
        function useDemoData() {
            const demoRegions = ['–ö–∏—ó–≤', '–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞', '–î–æ–Ω–µ—Ü—å–∫–∞'];
            let activeCount = 0;

            Object.keys(markers).forEach(region => {
                const marker = markers[region];
                
                if (demoRegions.includes(region)) {
                    marker.setStyle({
                        fillColor: '#e74c3c',
                        radius: 15
                    });
                    activeCount++;
                    marker.bindPopup(`
                        <div class="popup-content">
                            <h3>${region}</h3>
                            <div class="threat-info">
                                <strong>üö® –ü–û–í–Ü–¢–†–Ø–ù–ê –¢–†–ò–í–û–ì–ê!</strong><br>
                                –¢–∏–ø: –ë–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞ (–¥–µ–º–æ)<br>
                                <em>–¶–µ –¥–µ–º–æ-–¥–∞–Ω—ñ</em>
                            </div>
                        </div>
                    `);
                } else {
                    marker.setStyle({
                        fillColor: '#27ae60',
                        radius: 12
                    });
                    marker.bindPopup(`
                        <div class="popup-content">
                            <h3>${region}</h3>
                            <div class="safe-info">‚úÖ –¢—Ä–∏–≤–æ–≥–∏ –Ω–µ–º–∞—î</div>
                        </div>
                    `);
                }
            });

            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('safe-count').textContent = Object.keys(regions).length - activeCount;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('uk-UA');
        }

        // –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        updateAlerts();

        // –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateAlerts, 30000);
    </script>
</body>
</html>
